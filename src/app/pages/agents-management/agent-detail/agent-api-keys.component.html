<div class="py-3 flex items-center justify-between gap-4">
  <div>
    <!-- <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">
        API Keys
      </div>
      <div class="text-xs text-gray-500 dark:text-gray-400">
        Issued credentials for this agent.
      </div> -->
  </div>

  <button
    pButton
    type="button"
    icon="pi pi-plus"
    class="p-button p-button-primary"
    label="Create API Key"
    (click)="openCreateApiKey()"
  ></button>
</div>

<div
  *ngIf="apiKeysError && !apiKeysLoading"
  class="my-4 p-3 rounded-md bg-red-50 text-red-700 border border-red-200 text-sm"
>
  {{ apiKeysError }}
</div>

<div *ngIf="apiKeysLoading" class="flex justify-center py-8">
  <p-progressSpinner></p-progressSpinner>
</div>

<p-table
  *ngIf="!apiKeysLoading"
  [value]="apiKeys"
  [rowHover]="true"
  [showGridlines]="true"
  responsiveLayout="scroll"
  styleClass="p-datatable-sm"
  [tableStyle]="{ 'min-width': '760px' }"
>
  <ng-template pTemplate="header">
    <tr
      class="bg-gray-50 dark:bg-zinc-900 !text-sm text-gray-700 dark:text-gray-200"
    >
      <th class="">Name</th>
      <th class="">Client ID</th>
      <th class="">Environment</th>
      <th class="!text-center">Status</th>
      <th class="">Generated</th>
      <th class="!text-center">Action</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr class="!text-[13px]">
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.name }}
      </td>
      <td class="text-gray-700 dark:text-gray-200">
        {{ row.clientId }}
      </td>
      <td class="text-gray-700 dark:text-gray-200">
        {{ row.environment }}
      </td>

      <td class="!text-center">
        <span
          class="inline-flex px-2 py-0.5 rounded-md text-[11px] font-semibold"
          [ngClass]="
            row.active
              ? 'bg-emerald-100 text-emerald-700'
              : 'bg-red-100 text-red-700'
          "
        >
          {{ row.active ? "Active" : "Inactive" }}
        </span>
      </td>

      <td class="text-gray-700 dark:text-gray-200">
        {{
          row.dateGenerated
            ? (row.dateGenerated | date: "MMM d, yyyy, HH:mm")
            : "-"
        }}
      </td>
      <td class="!text-center">
        <button
          pButton
          type="button"
          class="p-button-rounded"
          icon="pi pi-pencil"
          pTooltip="Edit RES Account"
          tooltipPosition="bottom"
          (click)="openEditApiKey(row)"
        ></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td
        colspan="6"
        class="text-center text-gray-500 dark:text-gray-400 py-8 text-sm"
      >
        No API keys found.
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="apiKeyDialogVisible"
  [modal]="true"
  [style]="{ width: '480px' }"
  [closable]="!apiKeySubmitting"
  [draggable]="false"
  [resizable]="false"
  [header]="editingApiKey ? 'Edit API Key' : 'Create API Key'"
>
  <form [formGroup]="apiKeyForm" class="space-y-4">
    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Name</label
      >
      <input
        pInputText
        formControlName="name"
        type="text"
        class="w-full"
        placeholder="API key name"
      />
      <div
        *ngIf="
          apiKeyForm.get('name')?.invalid && apiKeyForm.get('name')?.touched
        "
        class="text-xs text-red-500"
      >
        Name is required.
      </div>
    </div>

    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Environment</label
      >
      <p-select
        formControlName="environment"
        [options]="environmentOptions"
        placeholder="Select environment"
        styleClass="w-full"
        appendTo="body"
      ></p-select>
      <div
        *ngIf="
          apiKeyForm.get('environment')?.invalid &&
          apiKeyForm.get('environment')?.touched
        "
        class="text-xs text-red-500"
      >
        Environment is required.
      </div>
    </div>

    <div class="flex items-center gap-2">
      <p-checkbox formControlName="active" binary="true"></p-checkbox>
      <span class="text-sm text-gray-700 dark:text-gray-200">Active</span>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      class="p-button-text"
      label="Cancel"
      [disabled]="apiKeySubmitting"
      (click)="apiKeyDialogVisible = false"
    ></button>
    <button
      pButton
      type="button"
      class="p-button-sm"
      [label]="editingApiKey ? 'Update' : 'Create'"
      [loading]="apiKeySubmitting"
      (click)="submitApiKey()"
    ></button>
  </ng-template>
</p-dialog>
