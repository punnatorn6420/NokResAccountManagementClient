<div class="py-3 flex items-center justify-between gap-4">
  <div>
    <!-- <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">
        RES Accounts
      </div>
      <div class="text-xs text-gray-500 dark:text-gray-400">
        Accounts linked to this agent.
      </div> -->
  </div>

  <button
    pButton
    type="button"
    icon="pi pi-plus"
    class="p-button p-button-primary"
    label="Create RES Account"
    (click)="openCreateResAccount()"
  ></button>
</div>

<div
  *ngIf="resAccountsError && !resAccountsLoading"
  class="mx-4 mt-4 p-3 rounded-md bg-red-50 text-red-700 border border-red-200 text-sm"
>
  {{ resAccountsError }}
</div>

<div *ngIf="resAccountsLoading" class="flex justify-center py-8">
  <p-progressSpinner></p-progressSpinner>
</div>

<p-table
  *ngIf="!resAccountsLoading"
  [value]="resAccounts"
  [rowHover]="true"
  [showGridlines]="true"
  responsiveLayout="scroll"
  styleClass="p-datatable-sm"
  [tableStyle]="{ 'min-width': '760px' }"
>
  <ng-template pTemplate="header">
    <tr
      class="bg-gray-50 dark:bg-zinc-900 !text-sm text-gray-700 dark:text-gray-200"
    >
      <th class="">Username</th>
      <th class="">Environment</th>
      <th class="!text-center">Primary</th>
      <th class="!text-center">Working</th>
      <th class="!text-center">Status</th>
      <th class="">Note</th>
      <th class="!text-center">Action</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr class="!text-[13px]">
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.userName }}
      </td>
      <td class="text-gray-700 dark:text-gray-200">
        {{ row.environment }}
      </td>

      <td class="!text-center">
        <span
          class="inline-flex px-2 py-0.5 rounded-md text-[11px] font-semibold"
          [ngClass]="
            row.isPrimary
              ? 'bg-amber-100 text-amber-800'
              : 'bg-gray-100 text-gray-700 dark:bg-zinc-800 dark:text-gray-200'
          "
        >
          {{ row.isPrimary ? "Primary" : "â€”" }}
        </span>
      </td>

      <td class="!text-center">
        <span
          class="text-xs"
          [ngClass]="
            row.isWorking
              ? 'text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-md font-semibold'
              : 'text-gray-500 dark:text-gray-400'
          "
        >
          {{ row.isWorking ? "Yes" : "No" }}
        </span>
      </td>

      <td class="!text-center">
        <span
          class="inline-flex px-2 py-0.5 rounded-md text-[11px] font-semibold"
          [ngClass]="
            row.active
              ? 'bg-emerald-100 text-emerald-700'
              : 'bg-red-100 text-red-700'
          "
        >
          {{ row.active ? "Active" : "Inactive" }}
        </span>
      </td>

      <td class="text-gray-700 dark:text-gray-200">
        {{ row.note || "-" }}
      </td>
      <td class="!text-center">
        <button
          pButton
          type="button"
          class="p-button-rounded"
          icon="pi pi-pencil"
          pTooltip="Edit"
          tooltipPosition="bottom"
          (click)="openEditResAccount(row)"
        ></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td
        colspan="7"
        class="text-center text-gray-500 dark:text-gray-400 py-8 text-sm"
      >
        No RES Accounts found.
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="resAccountDialogVisible"
  [modal]="true"
  [style]="{ width: '520px' }"
  [closable]="!resAccountSubmitting"
  [draggable]="false"
  [resizable]="false"
  [header]="editingResAccount ? 'Edit RES Account' : 'Create RES Account'"
>
  <form [formGroup]="resAccountForm" class="space-y-4">
    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Username</label
      >
      <input
        pInputText
        formControlName="userName"
        type="text"
        class="w-full"
        placeholder="res_username"
      />
      <div
        *ngIf="
          resAccountForm.get('userName')?.invalid &&
          resAccountForm.get('userName')?.touched
        "
        class="text-xs text-red-500"
      >
        Username is required.
      </div>
    </div>

    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Environment</label
      >
      <p-select
        formControlName="environment"
        [options]="environmentOptions"
        placeholder="Select environment"
        styleClass="w-full"
      ></p-select>
      <div
        *ngIf="
          resAccountForm.get('environment')?.invalid &&
          resAccountForm.get('environment')?.touched
        "
        class="text-xs text-red-500"
      >
        Environment is required.
      </div>
    </div>

    <div class="flex flex-wrap gap-4">
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="isPrimary" binary="true"></p-checkbox>
        <span class="text-sm text-gray-700 dark:text-gray-200">Primary</span>
      </div>
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="isWorking" binary="true"></p-checkbox>
        <span class="text-sm text-gray-700 dark:text-gray-200">Working</span>
      </div>
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="active" binary="true"></p-checkbox>
        <span class="text-sm text-gray-700 dark:text-gray-200">Active</span>
      </div>
    </div>

    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Note</label
      >
      <input
        pInputText
        formControlName="note"
        type="text"
        class="w-full"
        placeholder="Add a note (optional)"
      />
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      class="p-button-text"
      label="Cancel"
      [disabled]="resAccountSubmitting"
      (click)="resAccountDialogVisible = false"
    ></button>
    <button
      pButton
      type="button"
      class="p-button-sm"
      [label]="editingResAccount ? 'Update' : 'Create'"
      [loading]="resAccountSubmitting"
      (click)="submitResAccount()"
    ></button>
  </ng-template>
</p-dialog>
