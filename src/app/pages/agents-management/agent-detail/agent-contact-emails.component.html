<div class="py-3 flex items-center justify-between gap-4">
  <div>
    <!-- <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">
        Contact Emails
      </div>
      <div class="text-xs text-gray-500 dark:text-gray-400">
        Email records for this agent.
      </div> -->
  </div>

  <button
    pButton
    type="button"
    icon="pi pi-plus"
    class="p-button p-button-primary"
    label="Create Contact Email"
    (click)="openCreateContactEmail()"
  ></button>
</div>

<div
  *ngIf="contactEmailsError && !contactEmailsLoading"
  class="my-4 p-3 rounded-md bg-red-50 text-red-700 border border-red-200 text-sm"
>
  {{ contactEmailsError }}
</div>

<div *ngIf="contactEmailsLoading" class="flex justify-center py-8">
  <p-progressSpinner></p-progressSpinner>
</div>

<p-table
  *ngIf="!contactEmailsLoading"
  [value]="contactEmails"
  [rowHover]="true"
  [showGridlines]="true"
  responsiveLayout="scroll"
  styleClass="p-datatable-sm"
  [tableStyle]="{ 'min-width': '920px' }"
>
  <ng-template pTemplate="header">
    <tr
      class="bg-gray-50 dark:bg-zinc-900 !text-sm text-gray-700 dark:text-gray-200"
    >
      <th>First Name</th>
      <th>Last Name</th>
      <th>Contact Phone</th>
      <th>Email</th>
      <th class="!text-center">Primary</th>
      <th class="!text-center">Status</th>
      <th>Created</th>
      <th>Modified</th>
      <th class="!text-center">Action</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr class="!text-[13px]">
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.firstName || "-" }}
      </td>
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.lastName || "-" }}
      </td>
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.contactPhone || "-" }}
      </td>
      <td class="font-medium text-gray-900 dark:text-gray-100">
        {{ row.email }}
      </td>

      <td class="!text-center">
        <span
          class="inline-flex px-2 py-0.5 rounded-md text-[11px] font-semibold"
          [ngClass]="
            isContactEmailPrimary(row)
              ? 'bg-amber-100 text-amber-800'
              : 'bg-gray-100 text-gray-700 dark:bg-zinc-800 dark:text-gray-200'
          "
        >
          {{ isContactEmailPrimary(row) ? "Primary" : "â€”" }}
        </span>
      </td>

      <td class="!text-center">
        <span
          class="inline-flex px-2 py-0.5 rounded-md text-[11px] font-semibold"
          [ngClass]="
            row.active
              ? 'bg-emerald-100 text-emerald-700'
              : 'bg-red-100 text-red-700'
          "
        >
          {{ row.active ? "Active" : "Inactive" }}
        </span>
      </td>

      <td class="text-gray-700 dark:text-gray-200">
        {{ row.createdAt ? (row.createdAt | date: "MMM d, yyyy, HH:mm") : "-" }}
      </td>
      <td class="text-gray-700 dark:text-gray-200">
        {{
          row.modifiedAt ? (row.modifiedAt | date: "MMM d, yyyy, HH:mm") : "-"
        }}
      </td>
      <td class="!text-center">
        <button
          pButton
          type="button"
          class="p-button-rounded"
          icon="pi pi-pencil"
          pTooltip="Edit RES Account"
          tooltipPosition="bottom"
          (click)="openEditContactEmail(row)"
        ></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td
        colspan="9"
        class="text-center text-gray-500 dark:text-gray-400 py-8 text-sm"
      >
        No contact emails found.
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="contactEmailDialogVisible"
  [modal]="true"
  [style]="{ width: '480px' }"
  [closable]="!contactEmailSubmitting"
  [draggable]="false"
  [resizable]="false"
  [header]="editingContactEmail ? 'Edit Contact Email' : 'Create Contact Email'"
>
  <form [formGroup]="contactEmailForm" class="space-y-4">
    <div class="grid grid-cols-2 gap-3">
      <div class="space-y-1">
        <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
          >First Name</label
        >
        <input
          pInputText
          formControlName="firstName"
          type="text"
          class="w-full"
          placeholder="First name"
        />
      </div>
      <div class="space-y-1">
        <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
          >Last Name</label
        >
        <input
          pInputText
          formControlName="lastName"
          type="text"
          class="w-full"
          placeholder="Last name"
        />
      </div>
    </div>

    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Email</label
      >
      <input
        pInputText
        formControlName="email"
        type="email"
        class="w-full"
        placeholder="name@company.com"
      />
      <div
        *ngIf="
          contactEmailForm.get('email')?.invalid &&
          contactEmailForm.get('email')?.touched
        "
        class="text-xs text-red-500"
      >
        Please provide a valid email address.
      </div>
    </div>

    <div class="space-y-1">
      <label class="text-xs font-semibold text-gray-600 dark:text-gray-300"
        >Contact Phone</label
      >
      <input
        pInputText
        formControlName="contactPhone"
        type="text"
        class="w-full"
        placeholder="Contact phone"
        NumberInputDirective
      />
      <div
        *ngIf="
          contactEmailForm.get('contactPhone')?.invalid &&
          contactEmailForm.get('contactPhone')?.touched
        "
        class="text-xs text-red-500"
      >
        Please provide a valid contact phone.
      </div>
    </div>

    <div class="flex flex-wrap gap-4">
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="isPrimary" binary="true"></p-checkbox>
        <span class="text-sm text-gray-700 dark:text-gray-200">Primary</span>
      </div>
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="active" binary="true"></p-checkbox>
        <span class="text-sm text-gray-700 dark:text-gray-200">Active</span>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      class="p-button-text"
      label="Cancel"
      [disabled]="contactEmailSubmitting"
      (click)="contactEmailDialogVisible = false"
    ></button>
    <button
      pButton
      type="button"
      class="p-button-sm"
      [label]="editingContactEmail ? 'Update' : 'Create'"
      [loading]="contactEmailSubmitting"
      (click)="submitContactEmail()"
    ></button>
  </ng-template>
</p-dialog>
