<div class="p-6 bg-white dark:bg-black rounded-xl shadow-md">
  <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-300">
        Agent Detail
      </h2>
      <p class="text-sm text-gray-500 dark:text-gray-400">
        View agent profile information and related resources.
      </p>
    </div>
    <div class="flex flex-wrap items-center gap-2">
      <button
        pButton
        type="button"
        icon="pi pi-arrow-left"
        class="p-button-text"
        label="Back to list"
        (click)="navigateToList()"
      ></button>
      <button
        pButton
        type="button"
        icon="pi pi-pencil"
        class="p-button-outlined"
        label="Edit Agent"
        (click)="navigateToEdit()"
      ></button>
    </div>
  </div>

  <div
    *ngIf="errorMessage"
    class="mb-4 p-3 rounded-md bg-red-50 text-red-700 border border-red-200"
  >
    {{ errorMessage }}
  </div>

  <div *ngIf="loading" class="flex justify-center py-12">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <div *ngIf="!loading && agent" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <p-card>
        <ng-template pTemplate="title">Company</ng-template>
        <p class="text-lg font-semibold text-gray-700">
          {{ agent.companyName || '-' }}
        </p>
        <p class="text-sm text-gray-500">Agency Code: {{ agent.agencyCode }}</p>
      </p-card>
      <p-card>
        <ng-template pTemplate="title">Type & Currency</ng-template>
        <p class="text-lg font-semibold text-gray-700">
          {{ agent.type || '-' }}
        </p>
        <p class="text-sm text-gray-500">Currency: {{ agent.currency }}</p>
      </p-card>
      <p-card>
        <ng-template pTemplate="title">Primary Contact</ng-template>
        <p class="text-lg font-semibold text-gray-700">
          {{ getPrimaryEmail() }}
        </p>
        <p class="text-sm text-gray-500">Phone: {{ agent.phone || '-' }}</p>
      </p-card>
    </div>

    <p-tabView>
      <p-tabPanel header="Profile">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <div class="flex justify-between border-b pb-2">
              <span class="text-sm text-gray-500">Contact Name</span>
              <span class="text-sm font-medium"
                >{{ agent.firstName || '-' }} {{ agent.lastName || '' }}</span
              >
            </div>
            <div class="flex justify-between border-b pb-2">
              <span class="text-sm text-gray-500">Assigned By</span>
              <span class="text-sm font-medium">{{ agent.assignedBy || '-' }}</span>
            </div>
            <div class="flex justify-between border-b pb-2">
              <span class="text-sm text-gray-500">Created At</span>
              <span class="text-sm font-medium">
                {{ agent.createdAt ? (agent.createdAt | date: 'medium') : '-' }}
              </span>
            </div>
            <div class="flex justify-between border-b pb-2">
              <span class="text-sm text-gray-500">Last Modified</span>
              <span class="text-sm font-medium">
                {{ agent.modifiedAt ? (agent.modifiedAt | date: 'medium') : '-' }}
              </span>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-between border-b pb-2">
              <span class="text-sm text-gray-500">Address</span>
              <span class="text-sm font-medium text-right">
                {{ agent.address1 || '-' }}<br />
                {{ agent.address2 || '' }}<br />
                {{ agent.city || '' }} {{ agent.state || '' }}
                {{ agent.postalCode || '' }}<br />
                {{ agent.countryCode || '' }} {{ agent.region || '' }}
              </span>
            </div>
          </div>
        </div>
      </p-tabPanel>

      <p-tabPanel header="RES Accounts">
        <div *ngIf="resAccountsLoading" class="flex justify-center py-6">
          <p-progressSpinner></p-progressSpinner>
        </div>
        <p-table
          *ngIf="!resAccountsLoading"
          [value]="resAccounts"
          responsiveLayout="scroll"
          styleClass="p-datatable-sm"
          [tableStyle]="{ 'min-width': '700px' }"
        >
          <ng-template pTemplate="header">
            <tr class="bg-gray-100 !text-sm text-gray-700">
              <th class="!p-2">Username</th>
              <th class="!p-2">Environment</th>
              <th class="!p-2">Primary</th>
              <th class="!p-2">Working</th>
              <th class="!p-2">Active</th>
              <th class="!p-2">Note</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-row>
            <tr class="!text-xs">
              <td class="!p-2">{{ row.userName }}</td>
              <td class="!p-2">{{ row.environment }}</td>
              <td class="!p-2">{{ row.isPrimary ? 'Yes' : 'No' }}</td>
              <td class="!p-2">{{ row.isWorking ? 'Yes' : 'No' }}</td>
              <td class="!p-2">{{ row.active ? 'Active' : 'Inactive' }}</td>
              <td class="!p-2">{{ row.note || '-' }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="text-center text-gray-500 py-6">
                No RES Accounts found.
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <p-tabPanel header="Contact Emails">
        <div *ngIf="contactEmailsLoading" class="flex justify-center py-6">
          <p-progressSpinner></p-progressSpinner>
        </div>
        <p-table
          *ngIf="!contactEmailsLoading"
          [value]="contactEmails"
          responsiveLayout="scroll"
          styleClass="p-datatable-sm"
        >
          <ng-template pTemplate="header">
            <tr class="bg-gray-100 !text-sm text-gray-700">
              <th class="!p-2">Email</th>
              <th class="!p-2">Primary</th>
              <th class="!p-2">Active</th>
              <th class="!p-2">Created</th>
              <th class="!p-2">Modified</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-row>
            <tr class="!text-xs">
              <td class="!p-2">{{ row.email }}</td>
              <td class="!p-2">{{ row.isPrimary ? 'Yes' : 'No' }}</td>
              <td class="!p-2">{{ row.active ? 'Active' : 'Inactive' }}</td>
              <td class="!p-2">
                {{ row.createdAt ? (row.createdAt | date: 'short') : '-' }}
              </td>
              <td class="!p-2">
                {{ row.modifiedAt ? (row.modifiedAt | date: 'short') : '-' }}
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center text-gray-500 py-6">
                No contact emails found.
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <p-tabPanel header="API Keys">
        <div *ngIf="apiKeysLoading" class="flex justify-center py-6">
          <p-progressSpinner></p-progressSpinner>
        </div>
        <p-table
          *ngIf="!apiKeysLoading"
          [value]="apiKeys"
          responsiveLayout="scroll"
          styleClass="p-datatable-sm"
          [tableStyle]="{ 'min-width': '700px' }"
        >
          <ng-template pTemplate="header">
            <tr class="bg-gray-100 !text-sm text-gray-700">
              <th class="!p-2">Name</th>
              <th class="!p-2">Client ID</th>
              <th class="!p-2">Environment</th>
              <th class="!p-2">Active</th>
              <th class="!p-2">Generated</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-row>
            <tr class="!text-xs">
              <td class="!p-2">{{ row.name }}</td>
              <td class="!p-2">{{ row.clientId }}</td>
              <td class="!p-2">{{ row.environment }}</td>
              <td class="!p-2">{{ row.active ? 'Active' : 'Inactive' }}</td>
              <td class="!p-2">
                {{ row.dateGenerated ? (row.dateGenerated | date: 'short') : '-' }}
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center text-gray-500 py-6">
                No API keys found.
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>
    </p-tabView>
  </div>

  <div *ngIf="!loading && !agent && !errorMessage" class="py-10 text-center">
    <p class="text-gray-500">No agent information available.</p>
  </div>
</div>
